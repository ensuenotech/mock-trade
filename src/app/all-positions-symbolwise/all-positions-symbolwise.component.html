<div class="w-full">
  <mat-progress-bar mode="indeterminate" *ngIf="loading"></mat-progress-bar>
</div>
<div class="w-11/12 bg-gray-50 mx-auto mt-4">
  <div class="grid grid-cols-3 gap-5 mb-4">
    <div class="p-3 bg-white rounded-md">SD: {{getTotals().sd}}</div>
    <div class="p-3 bg-white rounded-md">CE: {{getTotals().ce}}</div>
    <div class="p-3 bg-white rounded-md">PE: {{getTotals().pe}}</div>
  </div>
  <div class="card">
    <div class="card-body">
      <div class="grid grid-cols-1 md:gap-4">
        <div
          class="border border-gray-100 rounded-md mt-2 md:mt-0 bg-white w-full"
        >
          <div class="px-3 py-2" *ngFor="let data of allPositions">
            <ng-container *ngIf="data.positionList.length > 0">
              <h3 class="mt-3 text-xl mb-3 text-gray-600">
                <span *ngIf="data.userId" class="float-right"
                  >UserId: {{ data.userId }}
                </span>
                Positions ({{ data.positionList.length }})
              </h3>
              <div class="px-3 py-2">
                <div
                  class="overflow-x-auto shadow ring-1 ring-black ring-opacity-5 rounded-sm"
                >
                  <table class="min-w-full divide-y divide-gray-300">
                    <thead class="bg-gray-50">
                      <tr>
                        <th
                          scope="col"
                          class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                          data-sort="desc"
                        >
                          Product<i class="fa fa-caret-up"></i>
                        </th>
                        <th
                          scope="col"
                          class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                          data-sort="desc"
                        >
                          Instrument<i class="fa fa-caret-up"></i>
                        </th>
                        <th
                          scope="col"
                          class="px-3 py-3.5 text-center text-sm font-semibold text-gray-900"
                          data-sort="desc"
                          colspan="2"
                        >
                          Qty.<i class="fa fa-caret-up"></i>
                        </th>
                        <th
                          scope="col"
                          class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900"
                          data-sort="desc"
                          style="min-width: 100px"
                        >
                          Avg.<i class="fa fa-caret-up"></i>
                        </th>
                        <th
                          scope="col"
                          class="px-3 w-1/6 py-3.5 text-left text-sm font-semibold text-gray-900"
                          data-sort="desc"
                        >
                          LTP<i class="fa fa-caret-up"></i>
                        </th>
                        <th
                          scope="col"
                          class="px-3 w-1/6 py-3.5 text-left text-sm font-semibold text-gray-900"
                          data-sort="desc"
                        >
                          P&L ({{
                            getpnlsum(data.positionList, data)
                              | number : "1.2-2"
                          }})
                        </th>
                      </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 bg-white">
                      <tr *ngFor="let item of data.positionList; let i = index">
                        <td
                          class="whitespace-nowrap px-3 py-4 text-sm text-gray-500"
                        >
                          <span class="buy-tab"
                            >{{ item.orderType | uppercase }}
                          </span>
                        </td>
                        <td
                          class="whitespace-nowrap px-3 py-4 text-sm text-gray-500"
                        >
                          {{ item.alias }}
                          <small class="text-uppercase">{{
                            item.expiry | date : "dd  MMM"
                          }}</small>
                        </td>
                        <td
                          class="whitespace-nowrap px-3 py-4 text-sm text-gray-500"
                        >
                          {{ item.quantity }}
                        </td>
                        <td
                          class="whitespace-nowrap px-3 py-4 text-sm text-gray-500"
                        ></td>
                        <td
                          class="whitespace-nowrap px-3 py-4 text-sm text-gray-500"
                        >
                          {{ item.avg | number : "1.2-2" }}
                        </td>
                        <td
                          class="whitespace-nowrap px-3 py-4 text-sm text-gray-500"
                        >
                          {{ item.ltp | number : "1.2-2" }}
                        </td>
                        <td
                          class="whitespace-nowrap px-3 py-4 text-sm text-gray-500 text-left border-l"
                        >
                          {{ item.pandl | number : "1.2-2" }}
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
